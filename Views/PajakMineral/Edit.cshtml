@model SIP.Models.PMineral

@{
    ViewBag.S2 = "";
    ViewBag.S3 = "";
    ViewBag.S4 = "";
}

<form id="sptpd" asp-action="SPTPD">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!--begin::Portlet-->
            <div class="kt-portlet" data-ktportlet="true" id="kt_portlet_tools_1">
                <div class="kt-portlet__head">
                    <div class="kt-portlet__head-label">
                        <h3 class="kt-portlet__head-title">
                            @ViewBag.Title
                        </h3>
                    </div>
                    <div class="kt-portlet__head-toolbar">
                        <div class="kt-portlet__head-group">
                            <a href="#" data-ktportlet-tool="toggle" class="btn btn-sm btn-icon btn-clean btn-icon-md"><i class="la la-angle-down"></i></a>
                        </div>
                    </div>
                </div>
                <div class="kt-portlet__body">
                    <input type="hidden" asp-for="IdSptpd" />
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    @await Component.InvokeAsync("FormSPTPD", new { id = Model.IdSptpd })
                    <div class="row kt-margin-t-10">
                        <div class="col-lg-12">
                            <div class="kt-section kt-section--first">
                                <h3 class="kt-section__title">Jumlah Mineral Bukan Logam:</h3>
                                <div class="kt-section__body">
                                    <input type="hidden" asp-for="IdMineral" form="sptpd" />
                                    <div class="row">
                                        <div class="col-lg-4 form-group">
                                            <label for="Bahan" class="control-label required">Jenis Bahan</label>
                                            <input type="text" id="Bahan " class="form-control" autocomplete="off" form="sptpd" required readonly value="@Model.IdSptpdNavigation.IdCoaNavigation.Uraian" />
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label asp-for="Volume" class="control-label required"></label>
                                            <div class="input-group">
                                                <input asp-for="Volume" class="form-control" autocomplete="off" min="1" value="@String.Format("{0:N0}", Model.Volume)" form="sptpd" required />
                                                <div class="input-group-append"><span class="input-group-text"><i class="normal-font">M<sup>3</sup></i></span></div>
                                            </div>
                                            <span asp-validation-for="Volume" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-3 form-group">
                                            <label asp-for="HargaJual" class="control-label required"></label>
                                            <div class="input-group">
                                                <div class="input-group-prepend"><span class="input-group-text"><i class="normal-font">Rp</i></span></div>
                                                <input asp-for="HargaJual" class="form-control rupiah" autocomplete="off" value="@String.Format("{0:N0}", Model.HargaJual)" onblur="cekharga()" placeholder="@String.Format("{0:N0}", ViewBag.Harga ?? 0)" form="sptpd" required />
                                            </div>
                                            <span asp-validation-for="HargaJual" class="text-danger"></span>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="hor-button">
                                                <a class="btn btn-sm btn-label-success btn-pill" onclick="hitung()"> Hitung <i class="la la-arrow-circle-right"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group kt-form__group row row-space">
                                        <div class="col-sm-12">
                                            Dasar Pengenaan Pajak Sebesar :
                                            <span class="kt-font-bold" id="Total"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="kt-portlet__foot">
                    <div class="kt-form__actions kt-align-right">
                        <a href="/SPTPD/@Model.IdSptpd" class="btn btn-secondary">Kembali</a>
                        <button type="submit" class="btn btn-primary" form="sptpd">Simpan</button>
                    </div>
                </div>
            </div>
            <!--end::Portlet-->
        </div>
    </div>
</form>


@section Scripts {
    <script src="~/js/spt.js"></script>
    <script src="~/js/rupiah.mask.js"></script>
    <script>
         function rupiah(a, currency) {
            return currency + a.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
        }

        var harga = "@ViewBag.Harga";

        function hitung() {
            var hVolume = document.getElementById("Volume").value.replace(".","");;
            var hHarga = document.getElementById("HargaJual").value.replace(".","");
            var total = hVolume * hHarga;
            document.getElementById("Total").innerHTML = (rupiah(total, 'Rp. '));
        }

        function cekharga() {
            var hHarga = document.getElementById("HargaJual").value.replace(".","");
            if (hHarga < harga) {
                document.getElementById("submitbtn").disabled = true;
                toastr.error("Harga harus lebih besar dari " + (rupiah(harga, "Rp. ")) + "!");
            }
            else {
                document.getElementById("submitbtn").disabled = false;
            }
        }
    </script>
}
